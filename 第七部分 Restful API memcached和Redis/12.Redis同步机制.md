# Redis同步机制
## RDB同步机制
1. 开启和关闭
默认情况下是开启的，如果想要关闭那么注释掉`redis.conf`文件中的save选项就可以了
2. 同步机制,设置时间间隔内发生超过设定数量的数据改写操作即执行同步，如：900秒以内发生一次改写。
    - save 900 1
    - save 300 10
    - save 60 10000
3. 存储内容
存储具体的Redis中的值，经过压缩以后进行存储。
4. 存储路径
根据`redis.conf`文件中的`dir`以及`rdbfilename`设置的值，默认是`/var/lib/redis/dump.rdb`
5. 优点
    - 数据存储到文件中会进行压缩，文件体积比aof存储文件小。
    - 因为存储的是Redis中的具体的值，并且经过了压缩，所以在灾难恢复时会比aof要快。
    - 非常适用于备份
6. 缺点
    rdb在设置的时间内发生设置值以上的数量的改写操作就会触发同步机制，因为数据存储是经过了压缩，rdb在同步时都重新保存整个Redis中的数据，因此如果一般同步时间为五分钟，则一旦发生故障，5分钟内的数据将丢失。
    当rdb进行同步时，Redis会fork出一个子进程用来同步，在数据量较大的时候可能会非常耗时。
## AOF同步机制
1. 开启和关闭
默认是关闭的，如果想要开启，修改`redis.conf`中的`appendonly`选项为`yes`
2. 同步机制
- appendfsync always: 每次数据更新操作都会同步到文件中。
- appendfsync everysec:每秒进行以此同步。
- appendfsync no:使用操作系统的方式进行更新，普遍是每30秒同步一次。
3. 存储内容
aof存储文件中存储的是具体的命令，不进行压缩
4. 存储路径根据`redis.conf`下的dir，以及`appendfilename`来指定，默认是`/var/lib/redis/appendonly.aof`
5. 优点
- aof的策略是每秒或每次发生数据改写操作是都户籍同步，即使服务器宕机，也只会丢失一秒的数据
- aof存储的是Redis的命令，并且直接在aof文件中进行追加写入，每次同步只需要新添加的数据就可以了，不需要全部重新同步
- 如果aof文件比较大了，Redis会进行重写，只保留最小的命令集合
6. 缺点
- aof文件因为没有压缩，因此文件体积比rdb文件要大
- aof在每秒或是每次改写数据的操作时都触发同步策略，因此如果并发量较大，效率可能会比较慢
- 因为aof文件中存储的是Redis的命令而不是值，在灾难恢复的时候需要重新读取并执行aof文件中的命令，因此灾难恢复的效率比rdb要慢